# 串口通讯

## 1. 概念

- 串行/并行
串行通信就像单车道，所有数据得一个一个通行，并行就像多车道，一次可以通行多辆车。

	<img src="C:\Users\ta\Desktop\串行.jpg" style="zoom:50%;" />

- 单工/双工
	| 单工   | 只允许单向通信                                     |
	| ------ | -------------------------------------------------- |
	| 半双工 | 同一时刻只允许单向通信，也就是在发送时无法接收数据 |
	| 全双工 | 同一时刻允许双向通信，也就是在发送时也可以接收数据 |

- 同步/异步

- 波特率
	衡量通讯性能的一个非常重要的参数就是通讯速率，通常以比特率(Bitrate)来表示，即每秒钟传输的二进制位数，单位为比特每秒(bit/s)。容易与比特率混淆的概念是“波特率”(Baudrate)，它表示每秒钟传输了多少个码元。而码元是通讯信号调制的概念，通讯中常用时间间隔相同的符号来表示一个二进制数字，这样的信号称为码元。如常见的通讯传输中，用 0V 表示数字 0，5V 表示数字 1，那么一个码元可以表示两种状态 0 和 1，所以一个码元等于一个二进制比特位，此时波特率的大小与比特率一致；如果在通讯传输中，有 0V、2V、4V 以及 6V 分别表示二进制数 00、01、10、11，那么每个码元可以表示四种状态，即两个二进制比特位，所以码元数是二进制比特位数的一半，这个时候的波特率为比特率的一半。因为很多常见的通讯中一个码元都是表示两种状态，人们常常直接以波特率来表示比特率，虽然严格来说没什么错误，但希望您能了解它们的区别。

## 2. 数据帧

<img src="C:\Users\ta\Desktop\串口数据帧2.jpg" style="zoom:50%;" />

- 起始位

    数据帧的起始信号由1个逻辑 0 的数据位表示。

- 数据位

    在数据帧的起始位之后紧接着的就是要传输的主体数据内容，也称为有效数据，有效数据的长度常被约定为 5、6、7 或8位长。

- 校验位

    在有效数据之后，有一个可选的数据校验位。由于数据通信相对更容易受到外部干扰导致传输数据出现偏差，可以在传输过程加上校验位来解决这个问题。校验方法有奇校验(odd)、偶校验(even)、0校验(space)、1校验(mark)以及无校验(noparity)。

    奇校验要求有效数据和校验位中 `1` 的个数为奇数，比如一个8位长的有效数据为：`01101001`，此时总共有 4 个 `1` ，为达到奇校验效果，校验位为 `1` ，最后传输的数据将是8位的有效数据加上1位的校验位总共9位。

    偶校验与奇校验要求刚好相反，要求帧数据和校验位中 `1` 的个数为偶数，比如数据帧：`11001010`，此时数据帧 `1` 的个数为4个，所以偶校验位为 `0` 。

    0 校验是不管有效数据中的内容是什么，校验位总为 `0` ，1校验是校验位总为 `1` 。

- 停止位

    数据帧的停止信号可由 0.5、1、1.5 或2个逻辑1的数据位表示，只要双方约定一致即可。
    
## 3. 通信时间
假设波特率为9600，8位数据位，无校验位，1位停止位。那么传输100个字节的数据需要多长时间？
已知一个字节由8的比特组成，传输一个字节只需要一个数据帧=1个起始位+8个数据位+0个校验位+1个停止位=10bit
波特率为9600，即传输一个bit需要`1/9600`s
总时间 = `1/9600 * 10 * 100` = 0.10417s